<% @nagios_servicegroups = [ ] -%>
<% @nd.each_pair do |k, v| -%>
<% if v.class == Hash -%>
<% v.each_pair do |s, l| -%>
<% if s == 'services'  -%>
<% l.each_pair do |e, c| -%>
<% @nagios_servicegroups << e -%>
<% end -%>
<% end -%>
<% end -%>
<% end -%>
<% end -%>
# autogenerated by puppet. do not touch
<% @nagios_servicegroups.uniq.each do  |x| -%>
<% @vhosts = [ ] -%>
<% @nd.each_pair do |k, v| -%>
<% if v.class == Hash -%>
<% v.each_pair do |s, l| -%>
<% if s == 'services'  -%>
<% l.each_pair do |e, c| -%>
<% if e == x -%>
<% @vhosts << k + '.' + v['domain'] -%>
<% end -%>
<% end -%>
<% end -%>
<% end -%>
<% end -%>
<% end -%>
<% if @vhosts.length > 0 %>
define servicegroup {
  servicegroup_name <%= x %>
  members <%= @vhosts.join(',' + x + ',') + ',' + x %>
}
<% end -%>
<% end -%>
