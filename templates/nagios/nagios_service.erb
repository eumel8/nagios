<% @ace = 1
   if @distribution['member'] == 'master' 
        @ace = 0
   end 
%>
# autogenerated by puppet. do not touch
define service {
        name                cloud-service
        is_volatile                    0
        max_check_attempts             3
        normal_check_interval          5
        active_checks_enabled          <%= @ace %>
        passive_checks_enabled         1
        parallelize_check              1
        check_period                   24x7
        obsess_over_service            1
        check_freshness                1
        event_handler_enabled          1
        flap_detection_enabled         1
<% if @pnp4nagios == '1' -%>
        process_perf_data              1
	action_url 		       /pnp4nagios/index.php/graph?host=$HOSTNAME$&srv=$SERVICEDESC$
<% else %>
	process_perf_data	       0
<% end -%>
<% if @notesurl -%>
        notes_url                      <%= @notesurl %>
<% end -%>
        failure_prediction_enabled     1
        retain_status_information      1
        retain_nonstatus_information   1
        notification_interval          90
        notification_period            24x7
        notification_options           w,u,c,r
        notifications_enabled          1
        contact_groups                 group_email
        register                       0
}


<% @nd.each_pair do |k, v| -%>
<% if v.class == Hash -%>
<% v.each_pair do |s, l| -%>
<% if s == 'services' -%>
<% l.each_pair do |e, c| -%>
define service {
  use cloud-service
  host_name <%= k %>
  service_description            <%= e %>
  check_command                  <%= c['check'] %>
<% if c['notes'] -%>
  contact_groups                 <%= c['notes'] %>
<% end -%>
}
<% end -%>
<% end -%>
<% end -%>
<% end -%>
<% end -%>

